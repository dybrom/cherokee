!function(){var e=angular.module("timeKeeper",["ngRoute","ui.bootstrap","toaster","ngAnimate","naif.base64"]);currentUser={id:0,name:"",teams:[],provider:"",token:""},e.constant("timeConfig",{apiUrl:"http://localhost:56111/api/",idsUrl:"http://localhost:53834/connect/token",dayType:["empty","workingday","publicholiday","otherabsence","religiousday","sickleave","vacation","businessabsence","weekend","future"],dayDesc:[" ","Working Day","Public Holiday","Other Absence","Religious Day","Sick Leave","Vacation","Business Absence"],months:["January","February","March","April","May","June","July","August","September","October","November","December"]}),e.config(["$routeProvider",function(e){e.when("/login",{templateUrl:"views/login.html",controller:"loginController",loginR:!1}).when("/logout",{templateUrl:"views/login.html",controller:"logoutController",loginR:!0}).when("/teams",{templateUrl:"views/teams.html",controller:"teamsController",loginR:!0}).when("/employees",{templateUrl:"views/employees.html",controller:"employeesController",loginR:!0}).when("/customers",{templateUrl:"views/customers.html",controller:"customersController",loginR:!0}).when("/projects",{templateUrl:"views/projects.html",controller:"projectsController",loginR:!0}).when("/calendar",{templateUrl:"views/timeTracking.html",controller:"timeTrackingController",loginR:!0}).when("/personalreport",{templateUrl:"views/personalReport.html",controller:"personalReportController",loginR:!0}).when("/annualreport",{templateUrl:"views/annualReport.html",controller:"annualReportController",loginR:!0}).when("/monthlyreport",{templateUrl:"views/monthlyReport.html",controller:"monthlyReportController",loginR:!0}).when("/projecthistory",{templateUrl:"views/projectHistory.html",controller:"projectHistoryController",loginR:!0}).when("/teamdashboard",{templateUrl:"views/teamDashboard.html",controller:"teamDashboardController",loginR:!0}).when("/companydashboard",{templateUrl:"views/companyDashboard.html",controller:"companyDashboardController",loginR:!0}).otherwise({redirectTo:"/login"})}]).run(["$rootScope","$location",function(e,t){e.$on("$routeChangeStart",function(e,o,n){0===currentUser.id&&o.$$route.loginR&&t.path("/login")})}])}(),function(){angular.module("timeKeeper").controller("annualReportController",["$scope","dataService","timeConfig","$location",function(e,t,o,n){function r(o){var n="reports/annual/";"undefined"!=o&&(n+=o),t.list(n,function(t){e.report=t,e.year=t.year})}"Administrator"!=e.currentUser.role?n.path("/calendar"):(e.months=o.months,e.showing=!1,e.listReport=function(){void 0==e.year?(e.showing=!1,window.alert("Choose year!")):(r(e.year),e.showing=!0)})}])}(),function(){angular.module("timeKeeper").controller("companyDashboardController",["$scope","dataService","timeConfig",function(e,t,o){e.months=o.months,e.month=6,e.year=2017,e.showing=!1,e.companyReport=function(){void 0==e.year?(e.showing=!1,window.alert("Choose year!")):void 0==e.month?(e.showing=!1,window.alert("Choose month!")):t.list("reports/CompanyReport?year="+e.year+"&month="+e.month,function(t){e.report=t,e.showing=!0,e.year=t.year,e.month=t.month,console.log(e.report);var o=document.getElementById("companyTotalHoursChart");Chart.defaults.global.defaultFontFamily="Lato",Chart.defaults.global.defaultFontSize=18;var n={labels:["Worked Hours","Total Hours Possible: Worked: "+e.report.maxPossibleHours+" + NotWorked: "+Math.abs(e.report.maxPossibleHours-e.report.totalHours)+" = "+e.report.totalHours],datasets:[{data:[e.report.maxPossibleHours,Math.abs(e.report.maxPossibleHours-e.report.totalHours)],backgroundColor:["#FF6384","#63FF84"]}]},r=(new Chart(o,{type:"pie",data:n}),new Array),a=new Array,l=new Array,i=new Array,s=new Array;angular.forEach(e.report.teams,function(e){r.push(e.name),a.push(e.missingEntries),l.push(e.overtimeHours)}),angular.forEach(e.report.projects,function(e){s.push(e.name),i.push(e.revenue)}),console.log(s,i),new Chart(document.getElementById("companyDashMissingEntries"),{type:"horizontalBar",data:{labels:r,datasets:[{label:"Missing Entries",data:a}]},options:{legend:{display:!1},title:{display:!0,text:"Missing Entries by Team"}}});var c=document.getElementById("companyPMutilization"),d={labels:["PM utilization","14.77"],datasets:[{data:[e.report.pmUtilization,100-e.report.pmUtilization],backgroundColor:["#FF6384","#63FF84"]}]},m=(new Chart(c,{type:"pie",data:d}),document.getElementById("companyDEVutilization")),u={labels:["DEV utilization","17.53"],datasets:[{data:[e.report.devUtilization,100-e.report.devUtilization],backgroundColor:["#FF6384","#63FF84"]}]},p=(new Chart(m,{type:"pie",data:u}),document.getElementById("companyUXUIutilization")),f={labels:["UXUI utilization","36.36"],datasets:[{data:[e.report.uiuxUtilization,100-e.report.uiuxUtilization],backgroundColor:["#FF6384","#63FF84"]}]},h=(new Chart(p,{type:"pie",data:f}),document.getElementById("companyQAutilization")),y={labels:["QA utilization","19.09"],datasets:[{data:[e.report.qaUtilization,100-e.report.qaUtilization],backgroundColor:["#FF6384","#63FF84"]}]};new Chart(h,{type:"pie",data:y}),new Chart(document.getElementById("companyOvertime"),{type:"bar",data:{labels:r,datasets:[{label:"Overtime",data:l}]},options:{legend:{display:!1},title:{display:!0,text:"Overtime hours by Team"}}}),new Chart(document.getElementById("companyRevenue"),{type:"bar",data:{labels:s,datasets:[{label:"Revenue",data:i}]},options:{legend:{display:!1},title:{display:!0,text:"Revenue by Team"}}})})}}])}(),function(){var e=angular.module("timeKeeper");e.controller("customersController",["$scope","dataService","$location",function(e,t,o){function n(){t.list("customers",function(t){e.customers=t})}"Administrator"!=e.currentUser.role?o.path("/calendar"):(n(),e.$on("customersUpdated",function(e){n()}))}]),e.controller("custController",["$scope","$uibModal","dataService",function(e,t,o){e.edit=function(e){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/modals/custModal.html",controller:"custModalCtrl",controllerAs:"$cust",resolve:{customer:function(){return e}}})},e.add=function(){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/modals/custModal.html",controller:"custModalCtrl",controllerAs:"$cust",resolve:{customer:function(){}}}).closed.then(function(){e.$emit("customersUpdated")})},e.delete=function(t){swal({title:t.name,text:"Are you sure you want to delete this customer?",type:"warning",showCancelButton:!0,customClass:"sweetClass",confirmButtonText:"Yes, sure",cancelButtonText:"No, not ever!",closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&(o.delete("customers",t.id,function(t){e.$emit("customersUpdated")}),swal.close())})}}]),e.controller("custModalCtrl",["$uibModalInstance","$scope","customer","dataService",function(e,t,o,n){console.log(o),t.customer=o,t.oldcustomer=angular.copy(o),t.save=function(t){console.log(t),void 0===t.id?n.insert("customers",t,function(t){window.alert("customer inserted!"),e.close()}):n.update("customers",t.id,t,function(t){window.alert("customer updated!"),e.close()})},t.cancel=function(){angular.copy(t.oldcustomer,o),e.dismiss()}}])}(),function(){var e=angular.module("timeKeeper");e.controller("employeesController",["$scope","dataService","$location",function(e,t,o){"Administrator"!=e.currentUser.role&&o.path("/calendar"),e.$on("employeesUpdated",function(o){t.list("employees",function(t,o){e.people=t})})}]),e.controller("empController",["$scope","$uibModal","dataService",function(e,t,o){e.showPagination=!0,e.currentPage=0,o.list("employees",function(t,o){e.page=JSON.parse(o("pagination")),console.log(e.page),e.message="",e.people=t,e.totalItems=e.page.TotalItems}),e.edit=function(o){t.open({animation:!0,ariaLabelledBy:"emp-modal-title",ariaLabelledBy:"emp-modal-body",templateUrl:"views/modals/empModal.html",controller:"EmpModalCtrl",controllerAs:"$emp",resolve:{person:function(){return o}}}).closed.then(function(){e.$emit("employeesUpdated")})},e.filter=function(t){""!=t?o.list("employees?pageSize=50&filter="+t,function(t,o){e.people=t,e.showPagination=!1}):""==t&&o.list("employees",function(t,o){e.people=t,e.showPagination=!0})},e.add=function(){t.open({animation:!0,ariaLabelledBy:"emp-modal-title",ariaLabelledBy:"emp-modal-body",templateUrl:"views/modals/empModal.html",controller:"EmpModalCtrl",controllerAs:"$emp",resolve:{person:function(){}}}).closed.then(function(){e.$emit("employeesUpdated")})},e.delete=function(t){swal({title:t.name,text:"Are you sure you want to delete this employee?",type:"warning",showCancelButton:!0,customClass:"sweetClass",confirmButtonText:"Yes, sure",cancelButtonText:"No, not ever!",closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&(o.delete("employees",t.id,function(t){window.alert("uspjesno!"),e.$emit("employeesUpdated")}),swal.close())})},e.pageChanged=function(){var t=e.currentPage-1;o.list("employees?page="+t,function(t,o){e.people=t}),console.log("Page changed to: "+e.currentPage)}}]),e.controller("EmpModalCtrl",["$uibModalInstance","$scope","person","dataService",function(e,t,o,n){n.list("roles",function(e){t.roles=e}),t.person=o,t.oldPerson=angular.copy(o),t.ok=function(o){void 0==o.id?(o.image=t.person.image?t.person.image.base64:"",n.insert("employees",o,function(){t.$emit("employeesUpdated"),window.alert("Employee successfully inserted!"),console.log(o)})):(o.image=t.person.image?t.person.image.base64:"",n.update("employees",o.id,o,function(e){t.$emit("employeesUpdated"),window.alert("Employee successfully updated!")})),e.close()},t.cancel=function(o){angular.copy(t.oldPerson,o),e.dismiss()}}])}(),function(){var e=angular.module("timeKeeper");e.controller("loginController",["$scope","$rootScope","$http","timeConfig","$location",function(e,t,o,n,r){function a(e){auth2.attachClickHandler(e,{},function(e){var a=e.getAuthResponse().id_token;o.defaults.headers.common.Authorization="Bearer "+a,o.defaults.headers.common.Provider="google",o({method:"post",url:n.apiUrl+"login"}).then(function(e){currentUser=e.data,t.currentUser=currentUser,console.log(currentUser),r.path("/calendar")},function(e){window.alert(e.message)})})}t.currentUser=currentUser,function(e){gapi.load("auth2",function(){auth2=gapi.auth2.init({client_id:"399815491541-mas0lligt1pm6lkqbkfvhph19vu419t7.apps.googleusercontent.com"}),a(document.getElementById(e))})}("loginBtn"),e.login=function(){var a={grant_type:"password",username:e.user.name,password:e.user.pass,scope:"openid"},l={"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic dGltZWtlZXBlcjokY2gwMGw="};o({method:"POST",url:n.idsUrl,headers:l,data:a,transformRequest:function(e){var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}}).success(function(e,a,l,i){authToken=e.access_token,o.defaults.headers.common.Authorization="Bearer "+authToken,o.defaults.headers.common.Provider="iserver",o({method:"GET",url:n.apiUrl+"login"}).success(function(e,o,n,a){currentUser=e,console.log(currentUser),t.currentUser=currentUser,r.path("/calendar")})}).error(function(e,t,o,n){console.log("ERROR: "+t)})}}]),e.controller("logoutController",["$rootScope","$location",function(e,t){currentUser={id:0,name:"",teams:[],provider:"",token:""},e.currentUser=currentUser,window.location.reload(),t.path("/calendar"),console.log(currentUser)}])}(),function(){angular.module("timeKeeper").controller("monthlyReportController",["$scope","dataService","timeConfig","$location",function(e,t,o,n){function r(o,n){var r="reports/monthly/";"undefined"!=o&&(r+=o),"undefined"!=n&&(r+="/"+n),t.list(r,function(t){e.report=t,e.year=t.year,e.month=t.month-1})}"Administrator"!=e.currentUser.role?n.path("/calendar"):(e.months=o.months,e.showing=!1,e.listReport=function(){void 0==e.year?(e.showing=!1,window.alert("Choose year!")):void 0==e.month?(e.showing=!1,window.alert("Choose month!")):(r(e.year,e.month),e.showing=!0)})}])}(),function(){angular.module("timeKeeper").controller("personalReportController",["$scope","dataService","timeConfig",function(e,t,o){function n(o,n,r){var a="reports/personal/"+o;"undefined"!=n&&(a+="/"+n),"undefined"!=r&&(a+="/"+r),t.list(a,function(t){e.report=t,e.empId=t.employee.id,e.year=t.year,e.month=t.month-1;var o=document.getElementById("utilizationChart");Chart.defaults.global.defaultFontFamily="Lato",Chart.defaults.global.defaultFontSize=18;var n={labels:["Utilization","Exploit"],datasets:[{data:[e.report.percentageOfWorkingDays,100-e.report.percentageOfWorkingDays],backgroundColor:["#FF6384","#63FF84"],borderColor:"white",borderWidth:2}]},r={rotation:-Math.PI,cutoutPercentage:30,circumference:Math.PI,legend:{position:"left"},animation:{animateRotate:!1,animateScale:!0}},a=(new Chart(o,{type:"doughnut",data:n,options:r}),document.getElementById("workingHoursChart"));Chart.defaults.global.defaultFontFamily="Lato",Chart.defaults.global.defaultFontSize=18;var l={labels:["Total Hours Possible","Worked Hours"],datasets:[{data:[e.report.totalHours,8*e.report.workingDaysInMonth-e.report.totalHours],backgroundColor:["#FF6384","#63FF84"]}]};new Chart(a,{type:"pie",data:l})})}if(e.months=o.months,e.month=6,e.year=2017,e.showing=!1,e.empsShow=!0,e.people=[],"Administrator"==e.currentUser.role)e.empsShow=!0,t.list("employees/all",function(t){e.people=t}),e.listReport=function(){void 0===e.empId?(e.showing=!1,window.alert("You have to choose an employee")):(n(e.empId,e.year,e.month+1),e.showing=!0)};else if(e.currentUser.teams.length>0){var r=[];r.push(e.currentUser.id),t.list("members",function(o){for(e.members=o,i=0;i<e.members.length;i++)for(j=0;j<e.currentUser.teams.length;j++)e.members[i].team.id==currentUser.teams[j].id&&e.members[i].employee.id!=e.currentUser.id&&r.push(e.members[i].employee.id);for(j=0;j<r.length;j++)t.read("employees",r[j],function(t){e.people.push(t)})}),e.empsShow=!0,e.listReport=function(){void 0===e.empId?(e.showing=!1,window.alert("You have to choose an employee")):(n(e.empId,e.year,e.month+1),e.showing=!0)}}else e.empsShow=!1,e.listReport=function(){n(e.currentUser.id,e.year,e.month+1),e.showing=!0}}])}(),function(){angular.module("timeKeeper").controller("projectHistoryController",["$scope","dataService",function(e,t){e.showing=!1,"Administrator"!=e.currentUser.role?$location.path("/calendar"):(t.list("projects",function(t){e.projects=t}),e.listReport=function(){void 0==e.projId?(e.showing=!1,window.alert("Choose project!!")):t.list("reports/projectsHistory?projectId="+e.projId,function(t){e.report=t,e.showing=!0,e.projId=t.id})})}])}(),function(){var e=angular.module("timeKeeper");e.controller("projectsController",["$scope","dataService",function(e,t){function o(){t.list("projects",function(t,o){e.projects=t})}o(),e.$on("projectsUpdated",function(e){o()})}]),e.controller("projController",["$scope","$uibModal","dataService",function(e,t,o){e.edit=function(e){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/modals/projModal.html",controller:"ModalCtrl",controllerAs:"$proj",resolve:{project:function(){return e}}})},e.add=function(o){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/modals/projModalAdd.html",controller:"ModalCtrl",controllerAs:"$proj",resolve:{project:function(){return o}}}).closed.then(function(){e.$emit("projectsUpdated")})},e.delete=function(t){swal({title:t.name,text:"Are you sure you want to delete this project?",type:"warning",showCancelButton:!0,customClass:"sweetClass",confirmButtonText:"Yes, sure",cancelButtonText:"No, not ever!",closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&(o.delete("projects",t.id,function(t){e.$emit("projectsUpdated")}),swal.close())})}}]),e.controller("ModalCtrl",["$uibModalInstance","$scope","project","dataService",function(e,t,o,n){n.list("customers",function(e){t.customers=e}),n.list("teams",function(e){t.teams=e}),console.log(o),t.project=o,t.oldproject=angular.copy(o),t.save=function(o){console.log(o),void 0===o.id?n.insert("projects",o,function(t){window.alert("Project inserted!"),e.close()}):n.update("projects",o.id,o,function(o){t.$emit("projectsUpdated"),window.alert("Project updated!"),e.close()})},t.cancel=function(){angular.copy(t.oldproject,o),e.dismiss()}}])}(),function(){angular.module("timeKeeper").controller("teamDashboardController",["$scope","dataService","timeConfig","$location",function(e,t,o,n){function r(o,n,r){var a="reports/TeamReport?teamId="+o;"undefined"!=n&&(a+="&year="+n),"undefined"!=r&&(a+="&month="+r),t.list(a,function(t){e.report=t,e.teamId=t.id,e.year=t.year,e.month=t.month-1,console.log(e.report.reports);var o=document.getElementById("teamTotalHoursChart");Chart.defaults.global.defaultFontFamily="Lato",Chart.defaults.global.defaultFontSize=18;var n={labels:["Total Hours Possible  [ENTIRE TEAM]","Worked Hours"],datasets:[{data:[e.report.totalHours,8*e.report.workingDaysInMonth-e.report.totalHours],backgroundColor:["#FF6384","#63FF84"]}]},r=(new Chart(o,{type:"pie",data:n}),new Array),a=new Array,l=new Array,i=new Array,s=new Array;angular.forEach(e.report.reports,function(e){var t=document.createElement("canvas");t.id="teamMember "+e.employee.id+" TotalHoursChart",teamDashboardCharts.append(t);var o=document.getElementById("teamMember "+e.employee.id+" TotalHoursChart");Chart.defaults.global.defaultFontFamily="Lato",Chart.defaults.global.defaultFontSize=18;var n={labels:["Total Hours Possible  ["+e.employee.name+"]  ","Worked Hours"],datasets:[{data:[e.totalHours,8*e.workingDaysInMonth-e.totalHours],backgroundColor:["#FF6384","#63FF84"]}]};new Chart(o,{type:"pie",data:n}),a.push(e.days.missingEntries),r.push(e.employee.name);var c=function(){return"rgb("+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+")"};l.push(c);var d=8*(e.days.overtimeHours+e.days.vacationDays+e.days.publicHolidays+e.days.sickLeaveDays+e.days.religiousDays+e.days.otherAbscenceDays);i.push(d),s.push(e.days.overtimeHours)}),new Chart(document.getElementById("teamDashMissingEntries"),{type:"horizontalBar",data:{labels:r,datasets:[{label:"Missing Hours",backgroundColor:l,data:a}]},options:{legend:{display:!1},title:{display:!0,text:"Missing Entries by Member"}}}),new Chart(document.getElementById("teamDashPTOByMember"),{type:"bar",data:{labels:r,datasets:[{label:"PTO",backgroundColor:l,data:i}]},options:{legend:{display:!1},title:{display:!0,text:"PTO by Member"}}}),new Chart(document.getElementById("teamDashOvertimeHoursByMember"),{type:"bar",data:{labels:r,datasets:[{label:"Overtime Hours",backgroundColor:l,data:s}]},options:{legend:{display:!1},title:{display:!0,text:"Overtime Hours by Member"}}})})}if(e.months=o.months,e.month=6,e.year=2017,e.showing=!1,e.teamsShow=!1,e.teams=[],new Object,"Administrator"==e.currentUser.role)e.teamsShow=!0,t.list("teams",function(t){e.teams=t});else if(e.currentUser.teams.length>0){e.teamsShow=!0;var a=[];for(i=0;i<e.currentUser.teams.length;i++)a.push(e.currentUser.teams[i].id);for(j=0;j<a.length;j++)t.read("teams",a[j],function(t){e.teams.push(t)})}else n.path("/calendar");e.listReport=function(){void 0==e.teamId&&(e.showing=!1,window.alert("Choose team!")),void 0==e.year?(e.showing=!1,window.alert("Choose year!")):void 0==e.month?(e.showing=!1,window.alert("Choose month!")):(r(e.teamId,e.year,e.month),e.show=!0)}}])}(),function(){var e=angular.module("timeKeeper");e.controller("teamsController",["$scope","$uibModal","dataService",function(e,t,o){e.message="Wait...",o.list("teams",function(t){e.message="",e.teams=t});e.$on("teamsUpdated",function(t){o.list("teams",function(t){console.log("nest"),e.message="",e.teams=t})}),e.$on("membersUpdated",function(t){o.list("members",function(t){console.log("nest"),e.message="",e.teams=t})}),e.add=function(){t.open({animation:!0,ariaLabelledBy:"tm-new-modal-title",ariaDescribedBy:"tm-new-modal-body",templateUrl:"views/modals/tmNewTeamModal.html",controller:"TmNewTeamModalCtrl",controllerAs:"$tm",resolve:{team:function(){}}}).closed.then(function(){e.$emit("teamsUpdated")})}}]),e.controller("TmNewTeamModalCtrl",["$uibModalInstance","$scope","team","dataService",function(e,t,o,n){t.team=o,t.add=function(o){n.insert("teams",o,function(o){t.$emit("teamsUpdated"),e.close()&&window.alert("Team added!")})},t.cancel=function(t){e.dismiss()}}]),e.controller("tmController",["$scope","$uibModal","dataService",function(e,t,o){e.edit=function(e){t.open({animation:!0,ariaLabelledBy:"tm-modal-title",ariaDescribedBy:"tm-modal-body",templateUrl:"views/modals/tmModal.html",controller:"TmModalCtrl",controllerAs:"$tm",resolve:{team:function(){return e}}})},e.addMember=function(o){t.open({animation:!0,ariaLabelledBy:"tm-add-emp-modal-title",ariaDescribedBy:"tm-add-emp-modal-body",templateUrl:"views/modals/tmAddEmpModal.html",controller:"TmAddEmpModalCtrl",controllerAs:"$tm",resolve:{member:function(){return o}}}).closed.then(function(){e.$emit("teamsUpdated")})},e.editMember=function(e){t.open({animation:!0,ariaLabelledBy:"tm-emp-modal-title",ariaDescribedBy:"tm-emp-modal-body",templateUrl:"views/modals/tmEmpModal.html",controller:"TmEmpModalCtrl",controllerAs:"$tm",resolve:{member:function(){return e}}})},e.delete=function(t){swal({title:t.name,text:"Are you sure you want to delete this team?",type:"warning",showCancelButton:!0,customClass:"sweetClass",confirmButtonText:"Yes, sure",cancelButtonText:"No, not ever!",closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&(o.delete("teams",t.id,function(t){window.alert("Successfully deleted!"),e.$emit("teamsUpdated")}),swal.close())})},e.deleteMember=function(t){swal({title:t.employee.name,text:"Are you sure you want to delete this employee from team "+t.team.name+"?",type:"warning",showCancelButton:!0,customClass:"sweetClass",confirmButtonText:"Yes, sure",cancelButtonText:"No, not ever!",closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&(o.delete("members",t.id,function(t){e.$emit("teamsUpdated")}),swal.close())})}}]),e.controller("TmModalCtrl",["$uibModalInstance","$scope","team","dataService",function(e,t,o,n){console.log(o),t.team=o,t.oldteam=angular.copy(o),t.ok=function(o){n.update("teams",o.id,o,function(o){t.$emit("teamsUpdated"),e.close()})},t.cancel=function(t){e.dismiss()}}]),e.controller("TmEmpModalCtrl",["$uibModalInstance","$scope","member","dataService",function(e,t,o,n){console.log(o),n.list("roles",function(e){t.roles=e}),t.member=o,t.oldMember=angular.copy(o),t.ok=function(t){n.update("members",t.id,t,function(t){e.close()})},t.cancel=function(o){angular.copy(t.oldMember,o),e.dismiss()}}]),e.controller("TmAddEmpModalCtrl",["$uibModalInstance","$scope","member","dataService",function(e,t,o,n){console.log(o),t.member=o,t.oldteam=angular.copy(o),n.list("employees/all",function(e){t.employees=e}),n.list("roles",function(e){t.roles=e}),t.add=function(t){var o={Role:{Id:t.role.id},Team:{Id:t.id},Employee:{Id:t.employee.id},hours:40};console.log(o),n.insert("members",o,function(t){e.close()&&window.alert("Member added!")})},t.cancel=function(o){angular.copy(t.oldteam,o),e.dismiss()}}])}(),function(){var e=angular.module("timeKeeper");e.controller("timeTrackingController",["$scope","$uibModal","dataService","timeConfig",function(e,t,o,n){function r(t,n,r){var a="calendar?id="+t;"undefined"!=n&&(a+="&year="+n),"undefined"!=r&&(a+="&month="+r),o.list(a,function(t){e.calendar=t,e.empId=t.employee.id,e.year=t.year,e.month=t.month-1,e.num=function(){var e=new Date(t.days[0].date).getDay()-1;return e<0&&(e=6),new Array(e)}})}if(e.dayType=n.dayType,e.months=n.months,e.month=6,e.year=2017,e.showEmployees=!1,e.people=[],"Administrator"==e.currentUser.role)e.showEmployees=!0,o.list("employees/all",function(t){e.people=t});else if(e.currentUser.teams.length>0){e.showEmployees=!0;var a=[];a.push(e.currentUser.id),o.list("members",function(t){for(e.members=t,i=0;i<e.members.length;i++)for(j=0;j<e.currentUser.teams.length;j++)e.members[i].team.id==currentUser.teams[j].id&&e.members[i].employee.id!=e.currentUser.id&&a.push(e.members[i].employee.id);for(j=0;j<a.length;j++)o.read("employees",a[j],function(t){e.people.push(t)})})}else e.empId=e.currentUser.id;e.buildCalendar=function(){void 0===e.empId?window.alert("You have to choose an employee"):r(e.empId,e.year,e.month+1)},e.$on("calendarUpdated",function(t){r(e.empId,e.year,e.month+1)}),e.edit=function(e){t.open({animation:!0,templateUrl:"views/modals/calendarModal.html",controller:"ModalCalendarCtrl",size:"lg",resolve:{day:function(){return e}}})}}]),e.controller("ModalCalendarCtrl",["$uibModalInstance","$scope","dataService","timeConfig","day",function(e,t,o,n,r){function a(){t.day.hours=0;for(var e=0;e<t.day.details.length;e++)t.day.details[e].deleted||(t.day.hours+=Number(t.day.details[e].hours))}function l(){t.newTask={id:0,description:"",hours:0,project:{id:0,name:""},deleted:!1}}t.day=r,t.dayType=n.dayDesc,o.list("projects",function(e){t.projects=e,console.log(t.day)}),l(),t.add=function(e){t.day.details.push(e),a(),l()},t.upd=function(e,t){a()},t.del=function(e){t.day.details[e].deleted=!0,a()},t.ok=function(){o.insert("calendar",t.day,function(e){t.$emit("calendarUpdated")}),a(),e.close()},t.cancel=function(){e.dismiss()},t.typeChanged=function(){1!=t.day.type&&(t.day.hours=8)}}])}(),function(){angular.module("timeKeeper").directive("customer",[function(){return{restrict:"E",scope:{data:"="},controller:"custController as $cust",templateUrl:"views/widgets/customer-widget.html"}}])}(),function(){angular.module("timeKeeper").directive("employee",[function(){return{restrict:"E",scope:{people:"=employee"},controller:"empController as $emp",templateUrl:"views/widgets/employee-widget.html"}}])}(),function(){angular.module("timeKeeper").directive("project",[function(){return{restrict:"E",scope:{data:"="},controller:"projController as $proj",templateUrl:"views/widgets/project-widget.html"}}])}(),function(){angular.module("timeKeeper").directive("team",[function(){return{restrict:"E",scope:{data:"=team"},controller:"tmController as $tm",templateUrl:"views/widgets/team-widget.html"}}])}(),function(){angular.module("timeKeeper").factory("dataService",["$rootScope","$http","timeConfig","infoService",function(e,t,o,n){function r(t){e.waitForLoad=t}var a=o.apiUrl;return{list:function(e,o){r(!0),t.get(a+e).then(function(e){return r(!1),o(e.data,e.headers)},function(t){r(!1),n.error(e,message)})},read:function(e,o,l){r(!0),t.get(a+e+"/"+o).then(function(e){return r(!1),l(e.data)},function(t){r(!1),n.error(e,message)})},insert:function(e,o,l){r(!0),t({method:"post",url:a+e,data:o}).then(function(t){return r(!1),n.success(e,"data successfully inserted"),l(t.data)},function(t){r(!1),n.error(e,message)})},update:function(e,o,l,i){r(!0),t({method:"put",url:a+e+"/"+o,data:l}).then(function(t){return r(!1),n.success(e,"data successfully updated"),i(t.data)},function(t){r(!1),n.error(e,message)})},delete:function(e,o,l){r(!0),t({method:"delete",url:a+e+"/"+o}).then(function(e){return r(!1),n.warning("are yA SURE?","data successfully deleted"),l(e.data)},function(t){r(!1),n.error(e,message)})}}}])}(),function(){angular.module("timeKeeper").factory("infoService",["toaster",function(e){return{info:function(t,o){e.pop("info",t,o,3e3)},success:function(t,o){e.pop("success",t,o,3e3)},warning:function(t,o){e.pop("warning",t,o,3e3)},error:function(e,t){swal({title:e,text:t,type:"error"})}}}])}();